@page "/login"
@using DBL
@using Models
@using Microsoft.AspNetCore.Components.Server.ProtectedBrowserStorage
@inject NavigationManager Nav
@inject ProtectedSessionStorage Storage

<h3>Login</h3>

<input placeholder="Username" @bind="username" />
<br />
<input placeholder="Password" type="password" @bind="password" />
<br />
<button @onclick="LoginMethod">Login</button>

<p>@message</p>

@code {
    string username;
    string password;
    string message;
    UserDB userDB = new UserDB();

    async Task LoginMethod()
    {
        if (string.IsNullOrWhiteSpace(username) || string.IsNullOrWhiteSpace(password))
        {
            message = "Username and password are required";
            return;
        }

        var user = await userDB.LoginAsync(username, password);
        if (user != null)
        {
            // Save user in session storage
            await Storage.SetAsync("user", user);
            Nav.NavigateTo("/"); // redirect to homepage
        }
        else
        {
            message = "Invalid username or password";
        }
    }
}
